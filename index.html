<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy 18th Birthday Tlinh!</title>
    <!-- Google Font Import (Pacifico) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <!-- Tailwind & Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* -- Animations -- */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
        @keyframes flicker { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes fadeInStep { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* -- Base Styles -- */
        body { font-family: sans-serif; background: linear-gradient(-45deg, #ecfccb, #a7f3d0, #fbcfe8, #fef08a, #d1fae5); background-size: 400% 400%; animation: gradientBG 15s ease infinite; min-height: 100vh; overflow-x: hidden; }
        .floating { animation: float 3s ease-in-out infinite; }
        .confetti { position: fixed; width: 10px; height: 10px; background-color: #f00; opacity: 0; z-index: 9999; animation: confetti 5s linear forwards; }
        .modal { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; transition: opacity 0.3s ease, visibility 0.3s ease; opacity: 0; visibility: hidden; z-index: 10050; background-color: rgba(0,0,0,0.5); padding: 1rem; }
        .modal.active { opacity: 1; visibility: visible; }
        .wish-popup { background-color: white; border-radius: 0.75rem; padding: 1rem 1.5rem; margin: 1rem; position: relative; max-width: 300px; width: 100%; text-align: center; z-index: 10070; }
        .wish-popup .close-btn { position: absolute; top: 0.5rem; right: 0.75rem; background: none; border: none; font-size: 1.5rem; line-height: 1; color: #6b7280; cursor: pointer; padding: 0; }
        .wish-popup .icon { font-size: 1.875rem; color: #10b981; margin-bottom: 0.75rem; }
        .wish-popup h3 { font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
        .wish-popup p { color: #374151; font-size: 0.875rem; line-height: 1.25rem; }
        @media (min-width: 640px) { .wish-popup p { font-size: 1rem; line-height: 1.5rem; } }

        /* -- Components -- */
        .envelope-heart { position: absolute; z-index: 20; }
        .envelope { transition: all 0.3s ease; perspective: 1000px; cursor: pointer; }
        .envelope:hover { transform: scale(1.1); }
        .envelope-inner { transition: all 0.5s ease; transform-style: preserve-3d; width: 100%; height: 100%; }
        .envelope.open .envelope-inner { transform: rotateX(180deg); }
        .envelope-front, .envelope-back { backface-visibility: hidden; position: absolute; width: 100%; height: 100%; }
        .envelope-front { background-color: #ccc; border-radius: 0.375rem; overflow: hidden; }
        .env-top { position: absolute; inset: 0; background-color: #15803d; clip-path: polygon(0% 0%, 100% 0%, 50% 50%); }
        .env-bottom { position: absolute; inset: 0; background-color: #22c55e; clip-path: polygon(0% 100%, 100% 100%, 50% 50%, 0% 100%); }
        .env-left { position: absolute; inset: 0; background-color: #16a34a; clip-path: polygon(0% 0%, 50% 50%, 0% 100%); }
        .env-right { position: absolute; inset: 0; background-color: #16a34a; clip-path: polygon(100% 0%, 50% 50%, 100% 100%); }
        .env-icon { position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%); color: white; }
        .envelope-back { transform: rotateX(180deg); background-color: #f0fdf4; display: flex; align-items: center; justify-content: center; padding: 0.25rem; border-radius: 0.375rem; }
        .profile-pic { object-fit: cover; border: 4px solid #4ade80; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .cake-container { position: relative; width: 280px; height: 300px; margin: 0 auto; }
        .cake-plate { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 240px; height: 18px; background: linear-gradient(to bottom, #d1fae5, #a7f3d0); border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1; }
        .cake-layer-1 { position: absolute; bottom: 18px; left: 50%; transform: translateX(-50%); width: 220px; height: 65px; background: linear-gradient(to bottom, #f472b6, #ec4899); border-radius: 8px 8px 0 0; box-shadow: inset 0 -8px 16px rgba(0,0,0,0.1); z-index: 4; overflow: hidden; }
        .cake-layer-2 { position: absolute; bottom: 83px; left: 50%; transform: translateX(-50%); width: 185px; height: 55px; background: linear-gradient(to bottom, #fcd34d, #f59e0b); border-radius: 8px 8px 0 0; box-shadow: inset 0 -8px 16px rgba(0,0,0,0.1); z-index: 3; overflow: hidden; }
        .cake-layer-3 { position: absolute; bottom: 138px; left: 50%; transform: translateX(-50%); width: 150px; height: 45px; background: linear-gradient(to bottom, #86efac, #4ade80); border-radius: 8px 8px 0 0; box-shadow: inset 0 -8px 16px rgba(0,0,0,0.1); z-index: 2; overflow: hidden; }
        .cake-decoration { position: absolute; z-index: 5; }
        .cake-drip { position: absolute; width: 18px; height: 27px; background: #ec4899; border-radius: 0 0 8px 8px; }
        .cake-sprinkle { position: absolute; width: 6px; height: 6px; border-radius: 50%; pointer-events: none; z-index: 6; }
        .date-highlight { background: linear-gradient(45deg, #4ade80, #22c55e); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: bold; }
        .heart-container { position: relative; margin: 0 auto; }
        .heart-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; }

        /* Loader Styles */
        #loader { position: fixed; inset: 0; background-color: #e0f2fe; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 1; transition: opacity 0.7s ease-out; }
        #loader i { font-size: 4rem; color: #fb7185; margin-bottom: 1.5rem; animation: spin 1.5s linear infinite; }
        #loader p { font-size: 1.25rem; color: #047857; font-weight: 600; }

        /* --- Step Navigation Styles --- */
        .step { display: none !important; animation: fadeInStep 0.6s ease-out; width: 100%; padding-bottom: 2rem; min-height: 50vh; }
        .step.active-step { display: block !important; }

        /* --- Navigation Button Styles --- */
        .nav-button { display: inline-block; padding: 0.75rem 1.5rem; margin-top: 1.5rem; background-image: linear-gradient(to right, #f472b6, #facc15); color: white; border-radius: 9999px; font-weight: 600; font-size: 1rem; text-align: center; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease, background-image 0.3s ease, opacity 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
         @media (min-width: 640px) { .nav-button { padding: 0.75rem 2rem; font-size: 1.125rem; } }
        .nav-button:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .nav-button:disabled { opacity: 0.6; cursor: not-allowed; background-image: linear-gradient(to right, #9ca3af, #d1d5db); transform: scale(1); box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* Reset hover effects */ }

        /* --- Visible Candle & Flame Styles --- */
        .candle {
            position: absolute;
            width: 10px;
            background-color: #FEF9E7; border: 1px solid #E59866;
            border-bottom: none; border-radius: 2px 2px 0 0; z-index: 10; transform-origin: bottom center;
        }
        .candle.horizontal { border-radius: 2px; border: 1px solid #E59866; }
        .flame { position: absolute; width: 18px; height: 27px; background: radial-gradient(circle, #ffffff, #f59e0b); border-radius: 50% 50% 20% 20%; box-shadow: 0 0 10px #f59e0b, 0 0 20px #f59e0b; opacity: 0; z-index: 11; transform-origin: bottom center; transition: opacity 0.3s ease; transform: translateX(-50%); }
        .flame.active { opacity: 1; animation: flicker 1s infinite alternate; }

        /* --- Positioning for "18" Candles --- */
        :root { --candle-base-bottom: 183px; --candle-width: 10px; --segment-height: 15px; --segment-v-height: 15px; --segment-h-width: 32px; --candle-total-height: calc(3 * var(--segment-height)); --digit-spacing: 15px; --total-width-18: calc(var(--candle-width) + var(--digit-spacing) + var(--segment-h-width)); --start-left-18: calc(50% - var(--total-width-18) / 2); --pos-1-x: var(--start-left-18); --pos-8-center-x: calc(var(--start-left-18) + var(--candle-width) + var(--digit-spacing) + var(--segment-h-width) / 2); --pos-8-left-x: calc(var(--pos-8-center-x) - var(--segment-h-width) / 2); --pos-8-right-x: calc(var(--pos-8-center-x) + var(--segment-h-width) / 2 - var(--candle-width)); --flame-bottom-1: calc(var(--candle-base-bottom) + var(--candle-total-height)); --flame-bottom-8: calc(var(--candle-base-bottom) + 2 * var(--segment-height)); }
         .candle-1 { bottom: var(--candle-base-bottom); left: var(--pos-1-x); height: var(--candle-total-height); width: var(--candle-width); }
         .flame-1 { bottom: var(--flame-bottom-1); left: calc(var(--pos-1-x) + var(--candle-width) / 2); }
         .candle-8-th { bottom: calc(var(--candle-base-bottom) + 2 * var(--segment-height)); left: var(--pos-8-center-x); width: var(--segment-h-width); height: var(--candle-width); transform: translateX(-50%); border-radius: 2px; border: 1px solid #E59866; }
         .candle-8-mh { bottom: calc(var(--candle-base-bottom) + var(--segment-height)); left: var(--pos-8-center-x); width: var(--segment-h-width); height: var(--candle-width); transform: translateX(-50%); border-radius: 2px; border: 1px solid #E59866; }
         .candle-8-bh { bottom: var(--candle-base-bottom); left: var(--pos-8-center-x); width: var(--segment-h-width); height: var(--candle-width); transform: translateX(-50%); border-radius: 2px; border: 1px solid #E59866; }
         .candle-8-tlv { bottom: calc(var(--candle-base-bottom) + var(--segment-height)); left: var(--pos-8-left-x); height: var(--segment-v-height); width: var(--candle-width); }
         .candle-8-trv { bottom: calc(var(--candle-base-bottom) + var(--segment-height)); left: var(--pos-8-right-x); height: var(--segment-v-height); width: var(--candle-width); }
         .candle-8-blv { bottom: var(--candle-base-bottom); left: var(--pos-8-left-x); height: var(--segment-v-height); width: var(--candle-width); border-radius: 0 0 2px 2px; border-top: none; }
         .candle-8-brv { bottom: var(--candle-base-bottom); left: var(--pos-8-right-x); height: var(--segment-v-height); width: var(--candle-width); border-radius: 0 0 2px 2px; border-top: none; }
         .flame-8-tlv { bottom: var(--flame-bottom-8); left: calc(var(--pos-8-left-x) + var(--candle-width) / 2); }
         .flame-8-trv { bottom: var(--flame-bottom-8); left: calc(var(--pos-8-right-x) + var(--candle-width) / 2); }

        /* --- Name on Cake Style --- */
        .cake-name { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-family: 'Pacifico', cursive; font-size: 1.7rem; color: white; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.2), 2px 2px 5px rgba(236, 72, 153, 0.5); z-index: 7; width: 100%; text-align: center; pointer-events: none; }
        /* --- Date on Cake Style --- */
        .cake-date { position: absolute; bottom: 110px; left: 50%; transform: translate(-50%, 50%); font-size: 1.2rem; font-weight: bold; color: white; text-shadow: 1px 1px 0px #854d0e, 2px 2px 4px rgba(0,0,0,0.4); z-index: 15; pointer-events: none; white-space: nowrap; }
         /* Audio Player Styling */
        #birthday-song-audio { display: none; }
        .audio-controls button i { margin-right: 0.5rem; }

    </style>
</head>
<body>

    <!-- Loader -->
    <div id="loader"> <i class="fas fa-heart"></i> <p>Loading Tlinh's Birthday Surprise...</p> </div>
    <!-- Confetti -->
    <div id="confetti-container"></div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-6 sm:py-8">

        <!-- STEP 1: WELCOME -->
        <div id="step-welcome" class="step">
             <header class="text-center mb-8 md:mb-12"> <div class="date-badge inline-block bg-gradient-to-r from-pink-500 to-yellow-500 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-full mb-4 sm:mb-6 shadow-lg"><span class="text-xl sm:text-2xl font-bold">ðŸŽ‚ May 12th ðŸŽ‚</span></div> <h1 class="text-4xl sm:text-5xl md:text-7xl font-bold text-green-800 mb-4 md:mb-6 floating">Happy 18th Birthday!</h1> <h2 class="text-2xl sm:text-3xl md:text-5xl font-semibold text-green-700">Tlinh ðŸ’š</h2> <div class="mt-6 md:mt-8"><p class="text-lg sm:text-xl text-green-600">Celebrating your special day on <span class="date-highlight">May 12th</span>!</p></div> </header>
             <div class="text-center"><button class="nav-button" onclick="showStep('step-audio')">Hear Your Song! <i class="fas fa-arrow-right ml-2"></i></button></div>
        </div>

        <!-- STEP 2: AUDIO -->
        <div id="step-audio" class="step">
            <h3 class="text-3xl md:text-4xl font-semibold text-green-800 mb-6 text-center">A Special Song Just For You! ðŸŽµ</h3>
            <p class="text-lg text-green-600 mb-8 text-center">Use the buttons below to play the song.</p>
            <div class="text-center mb-8 audio-controls">
                 <button id="play-btn" class="nav-button mx-1"> <i class="fas fa-play"></i>Play </button>
                 <button id="pause-btn" class="nav-button mx-1" disabled> <i class="fas fa-pause"></i>Pause </button>
                 <button id="repeat-btn" class="nav-button mx-1"> <i class="fas fa-redo"></i>Repeat </button>
            </div>
            <audio id="birthday-song-audio" preload="metadata">
                 <source src="the_nights.mp3" type="audio/mpeg"> Your browser does not support the audio element.
            </audio>
            <div class="text-center">
                 <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-welcome')"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                 <button class="nav-button ml-4" onclick="showStep('step-cake')">See Your Cake! <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div>

        <!-- STEP 3: CAKE -->
        <div id="step-cake" class="step">
            <h3 class="text-3xl md:text-4xl font-semibold text-green-800 mb-6 text-center">Here's Your Cake!</h3>
            <div class="flex justify-center mb-12 md:mb-16">
                 <div class="cake-container">
                     <div class="cake-plate"></div>
                     <div class="cake-layer-1" id="layer1"><div class="cake-name">Tlinh</div></div>
                     <div class="cake-layer-2" id="layer2"></div>
                     <div class="cake-date">12.05</div>
                     <div class="cake-layer-3" id="layer3"></div>
                     <div class="cake-decoration" style="bottom: 18px; left: 30%;"><div class="cake-drip" style="background: #ec4899;"></div></div>
                     <div class="cake-decoration" style="bottom: 18px; left: 50%;"><div class="cake-drip" style="background: #f59e0b; height: 22px;"></div></div>
                     <div class="cake-decoration" style="bottom: 18px; left: 70%;"><div class="cake-drip" style="background: #4ade80;"></div></div>
                     <div class="candle candle-1"></div> <div class="flame flame-1"></div>
                     <div class="candle candle-8-th"></div> <div class="candle candle-8-mh"></div> <div class="candle candle-8-bh"></div>
                     <div class="candle candle-8-tlv"></div> <div class="candle candle-8-trv"></div>
                     <div class="candle candle-8-blv"></div> <div class="candle candle-8-brv"></div>
                     <div class="flame flame-8-tlv"></div> <div class="flame flame-8-trv"></div>
                 </div>
            </div>
            <div class="flex justify-center mb-12 md:mb-16"><button id="blow-btn" class="nav-button"><i class="fas fa-birthday-cake mr-2"></i> Make a Wish & Blow!</button></div>
             <div class="text-center">
                 <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-audio')"><i class="fas fa-arrow-left mr-2"></i> Back to Song</button>
             </div>
        </div>

        <!-- STEP 4: MESSAGE -->
        <div id="step-message" class="step">
             <div class="max-w-full md:max-w-2xl mx-auto bg-white bg-opacity-90 rounded-xl p-6 md:p-8 shadow-lg mb-8 md:mb-12 text-center border-2 border-green-200"> <h3 class="text-2xl md:text-3xl font-semibold text-green-800 mb-4 md:mb-6">Dear Tlinh,</h3> <p class="text-green-700 mb-4 md:mb-6 text-base md:text-lg">Hope you liked the song and the cake for your 18th birthday on <span class="date-highlight">May 12th</span>! Now it's time for 18 special wishes... But first, let's see a video message.</p> <p class="text-green-700 font-medium text-lg md:text-xl">Wishing you a fantastic year! May <span class="date-highlight">12.05</span> be just the start! ðŸŽ‰</p> </div>
             <div class="bg-white bg-opacity-80 rounded-xl p-4 sm:p-6 max-w-xs sm:max-w-sm md:max-w-md mx-auto shadow-lg text-center mb-12 md:mb-16"> <h3 class="text-xl sm:text-2xl font-semibold text-green-800 mb-4">Celebrating <span class="date-highlight">May 12th</span>!</h3> <div class="flex justify-center space-x-2 sm:space-x-4"> <div class="bg-green-100 rounded-lg p-2 sm:p-3 w-14 sm:w-16"><div class="text-xl sm:text-2xl font-bold text-green-800">18</div><div class="text-xs text-green-600">YEARS</div></div> <div class="bg-green-100 rounded-lg p-2 sm:p-3 w-14 sm:w-16"><div class="text-xl sm:text-2xl font-bold text-green-800">12</div><div class="text-xs text-green-600">MAY</div></div> <div class="bg-green-100 rounded-lg p-2 sm:p-3 w-14 sm:w-16"><div class="text-xl sm:text-2xl font-bold text-green-800">ðŸ’š</div><div class="text-xs text-green-600">LOVE</div></div> </div> <p class="mt-4 text-sm sm:text-base text-green-700">Your special date: <span class="font-bold date-highlight">May 12th</span></p> </div>
             <div class="text-center"> <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-cake')"><i class="fas fa-arrow-left mr-2"></i> Back to Cake</button> <button class="nav-button ml-4" onclick="showStep('step-gallery')">See Video <i class="fas fa-arrow-right ml-2"></i></button> </div>
        </div>

        <!-- STEP 5: VIDEO MEMORY (Using aspect-video) -->
        <div id="step-gallery" class="step">
             <section class="mb-12 md:mb-16">
                 <h3 class="text-3xl md:text-4xl font-semibold text-green-800 mb-6 md:mb-8 text-center">A Special Video Memory ðŸŽ¬</h3>
                 <p class="text-lg text-green-600 mb-8 text-center">Press play to watch a special message or relive some moments!</p>

                 <!-- Video Player -->
                 <div class="max-w-2xl mx-auto">
                     <video controls class="w-full aspect-video bg-black rounded-lg shadow-lg border-2 border-green-200" preload="metadata">
                          <!-- IMPORTANT: Replace src with the actual path to YOUR video file -->
                          <source src="path/to/your_birthday_video.mp4" type="video/mp4">

                          <!-- Optional: Add other formats for better browser compatibility -->
                          <!-- <source src="path/to/your_birthday_video.webm" type="video/webm"> -->
                          <!-- <source src="path/to/your_birthday_video.ogg" type="video/ogg"> -->

                          <!-- Fallback message if browser doesn't support video -->
                          Sorry, your browser doesn't support embedded videos. Maybe it's time for an update?
                      </video>
                 </div>
             </section>

             <!-- Navigation Buttons -->
             <div class="text-center">
                 <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-message')"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                 <button class="nav-button ml-4" onclick="showStep('step-wishes')">Open Wishes <i class="fas fa-arrow-right ml-2"></i></button>
             </div>
        </div>

        <!-- STEP 6: WISHES (Mobile Optimized Layout) -->
         <div id="step-wishes" class="step">
             <div class="text-center mb-10 md:mb-12"><h3 class="text-3xl md:text-4xl font-semibold text-green-800 mb-4"><i class="fas fa-heart text-pink-500"></i> Heart Full of Wishes! <i class="fas fa-heart text-pink-500"></i></h3><p class="text-lg text-green-600">Click each envelope...</p></div>
             <div class="heart-container w-full max-w-xs sm:max-w-sm md:max-w-lg lg:max-w-[700px] xl:max-w-[850px] h-[500px] sm:h-[500px] md:h-[550px] mb-16 md:mb-20 mx-auto">
                 <div class="heart-center"><div class="bg-white p-1 rounded-full w-28 h-28 sm:w-32 sm:h-32 md:w-40 md:h-40 lg:w-44 lg:h-44 xl:w-[200px] xl:h-[200px]"><img src="https://static.vecteezy.com/system/resources/previews/005/562/361/non_2x/cute-and-kawaii-girl-with-pink-hoodie-bunny-and-cute-rabbit-cartoon-manga-chibi-character-vector.jpg" alt="Tlinh" class="profile-pic w-full h-full rounded-full"></div></div>
                 <!-- Envelopes 1-18 -->
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 8%; left: 38%; z-index: 20;" onclick="openWish(1)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 8%; left: 62%; transform: translateX(-100%); z-index: 20;" onclick="openWish(2)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 18%; left: 25%; z-index: 20;" onclick="openWish(3)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 18%; left: 75%; transform: translateX(-100%); z-index: 20;" onclick="openWish(4)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 30%; left: 18%; z-index: 20;" onclick="openWish(5)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 30%; left: 82%; transform: translateX(-100%); z-index: 20;" onclick="openWish(6)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 45%; left: 12%; z-index: 20;" onclick="openWish(7)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 45%; left: 88%; transform: translateX(-100%); z-index: 20;" onclick="openWish(8)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 60%; left: 15%; z-index: 20;" onclick="openWish(9)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 60%; left: 85%; transform: translateX(-100%); z-index: 20;" onclick="openWish(10)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 72%; left: 22%; z-index: 20;" onclick="openWish(11)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 72%; left: 78%; transform: translateX(-100%); z-index: 20;" onclick="openWish(12)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 83%; left: 30%; z-index: 20;" onclick="openWish(13)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 83%; left: 70%; transform: translateX(-100%); z-index: 20;" onclick="openWish(14)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 91%; left: 40%; z-index: 20;" onclick="openWish(15)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 91%; left: 60%; transform: translateX(-100%); z-index: 20;" onclick="openWish(16)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 96%; left: 48%; transform: translateX(-50%); z-index: 20;" onclick="openWish(17)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
                 <div class="envelope-heart w-12 h-8 sm:w-16 sm:h-10 md:w-20 md:h-12" style="top: 96%; left: 52%; transform: translateX(-50%); z-index: 20;" onclick="openWish(18)"> <div class="envelope w-full h-full relative"><div class="envelope-inner"><div class="envelope-front"><div class="env-top"></div><div class="env-bottom"></div><div class="env-left"></div><div class="env-right"></div><div class="env-icon text-base sm:text-lg md:text-xl"><i class="fas fa-heart"></i></div></div><div class="envelope-back"><p class="text-green-700 text-[8px] sm:text-[10px] md:text-xs font-semibold">Open</p></div></div></div> </div>
            </div>
             <div class="text-center"> <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-gallery')"><i class="fas fa-arrow-left mr-2"></i> Back</button> <button class="nav-button ml-4" onclick="showStep('step-final')">Finish <i class="fas fa-check ml-2"></i></button> </div>
         </div>

        <!-- STEP 7: FINAL -->
         <div id="step-final" class="step">
             <footer class="text-center mt-12 mb-6 px-4">
                <h3 class="text-3xl font-semibold text-green-800 mb-6">That's All For Now!</h3>
                <p class="text-lg text-green-700 mb-8">Hope you loved your birthday surprise, Tlinh!</p>
                <p class="text-green-600 text-sm sm:text-base">Made with ðŸ’š by [Your Name Here]</p>
                <div class="mt-8">
                    <button class="nav-button" style="background-image: linear-gradient(to right, #a7f3d0, #6ee7b7);" onclick="showStep('step-wishes')"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                    <button class="nav-button ml-4" style="background-image: linear-gradient(to right, #fbbf24, #f59e0b);" onclick="showStep('step-welcome')"><i class="fas fa-redo mr-2"></i> Start Over?</button>
                </div>
             </footer>
         </div>

    </div> <!-- End Container -->

    <!-- Popups -->
    <div id="blow-popup" class="modal"><div class="bg-white rounded-xl p-6 sm:p-8 max-w-md w-full relative border-4 border-pink-300"><div class="text-center"><div class="text-5xl sm:text-6xl mb-4 sm:mb-6 text-pink-500">ðŸŽ‰</div><h3 class="text-2xl sm:text-3xl font-bold text-green-800 mb-4">Wish Granted!</h3><p class="text-green-700 mb-6 text-base sm:text-lg">Hope your wish on <span class="date-highlight">May 12th</span> comes true!</p><button id="yay-button" class="nav-button"><i class="fas fa-smile-wink mr-2"></i> Yay! Continue!</button></div></div></div>
    <div id="wish-popup-1" class="modal"><div class="wish-popup"><button onclick="closeWish(1)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #1</h3><p>May your 18th year be filled with joy and success!</p></div></div> <div id="wish-popup-2" class="modal"><div class="wish-popup"><button onclick="closeWish(2)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #2</h3><p>Wishing you endless happiness on your special day!</p></div></div> <div id="wish-popup-3" class="modal"><div class="wish-popup"><button onclick="closeWish(3)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #3</h3><p>Happy 18th Birthday! May all your dreams take flight.</p></div></div> <div id="wish-popup-4" class="modal"><div class="wish-popup"><button onclick="closeWish(4)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #4</h3><p>Welcome to adulthood! Enjoy every moment.</p></div></div> <div id="wish-popup-5" class="modal"><div class="wish-popup"><button onclick="closeWish(5)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #5</h3><p>Hope your birthday is as amazing as you are!</p></div></div> <div id="wish-popup-6" class="modal"><div class="wish-popup"><button onclick="closeWish(6)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #6</h3><p>Cheers to 18 years and many more to come!</p></div></div> <div id="wish-popup-7" class="modal"><div class="wish-popup"><button onclick="closeWish(7)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #7</h3><p>May your day be filled with love, laughter, and cake!</p></div></div> <div id="wish-popup-8" class="modal"><div class="wish-popup"><button onclick="closeWish(8)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #8</h3><p>Wishing you all the best on this milestone birthday!</p></div></div> <div id="wish-popup-9" class="modal"><div class="wish-popup"><button onclick="closeWish(9)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #9</h3><p>Keep being your awesome self! Happy 18th!</p></div></div> <div id="wish-popup-10" class="modal"><div class="wish-popup"><button onclick="closeWish(10)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #10</h3><p>Sending you the biggest birthday hug!</p></div></div> <div id="wish-popup-11" class="modal"><div class="wish-popup"><button onclick="closeWish(11)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #11</h3><p>Hope your 18th year is full of great adventures!</p></div></div> <div id="wish-popup-12" class="modal"><div class="wish-popup"><button onclick="closeWish(12)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #12</h3><p>May happiness follow you wherever you go.</p></div></div> <div id="wish-popup-13" class="modal"><div class="wish-popup"><button onclick="closeWish(13)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #13</h3><p>Eighteen looks great on you! Happy Birthday!</p></div></div> <div id="wish-popup-14" class="modal"><div class="wish-popup"><button onclick="closeWish(14)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #14</h3><p>Wishing you a day as sunny as your smile!</p></div></div> <div id="wish-popup-15" class="modal"><div class="wish-popup"><button onclick="closeWish(15)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #15</h3><p>Happy 18th! Time to make some amazing memories.</p></div></div> <div id="wish-popup-16" class="modal"><div class="wish-popup"><button onclick="closeWish(16)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #16</h3><p>May your future be bright and beautiful.</p></div></div> <div id="wish-popup-17" class="modal"><div class="wish-popup"><button onclick="closeWish(17)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #17</h3><p>Wishing you strength and courage for the road ahead.</p></div></div> <div id="wish-popup-18" class="modal"><div class="wish-popup"><button onclick="closeWish(18)" class="close-btn">Ã—</button><div class="icon">ðŸ’Œ</div><h3>Wish #18</h3><p>Happy Birthday, Tlinh! You are truly special!</p></div></div>

    <!-- Audio Elements -->
    <audio id="puff-sound" preload="auto" style="display:none;"><source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAA//8CAP/+//8A//8AAAAAAAD//wAAAP/AAAAA//8AAAD/AAAAAAACAPkABgL4/+ED8QDd/+YDiwOABIAA7wHtARAJ7AF1APoB9wEKAvwBugEWBBQA7/8kAcsACgHqAPoA/QDtAT4CfgHBAgEAIgEBAAEC7f/xAdsB+AHDAh0BLQBcAGEAYQBRAMoAagBQAIMAXgBSAGwAWgBuAIUAgQCFAIkAfAB+AIsAlQCiAKQAogCtALUAtQC1ALEAnQCpAJoAnACuAKgAoACpAKQAngCeALIArwCqAKMAlwCZAA==" type="audio/wav"></audio>

    <script>
        "use strict";
        const log=(m,...a)=>console.log(`[B] ${m}`,...a),err=(m,...a)=>console.error(`[B ERR] ${m}`,...a);

        // Birthday Song Playback Logic
        const birthdayAudio = document.getElementById('birthday-song-audio');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const repeatBtn = document.getElementById('repeat-btn');

        if (playBtn && pauseBtn && repeatBtn && birthdayAudio) {
            playBtn.addEventListener('click', () => { log("Play"); try { birthdayAudio.play().catch(e => err("Audio Play", e)); } catch (e) { err("Audio", e); } });
            pauseBtn.addEventListener('click', () => { log("Pause"); try { birthdayAudio.pause(); } catch (e) { err("Audio", e); } });
             repeatBtn.addEventListener('click', () => { log("Repeat"); try { birthdayAudio.currentTime = 0; birthdayAudio.play().catch(e => err("Audio Play", e)); } catch (e) { err("Audio", e); } });
            birthdayAudio.addEventListener('play', () => { log("Playing"); playBtn.disabled = true; pauseBtn.disabled = false; });
            birthdayAudio.addEventListener('pause', () => { log("Paused"); playBtn.disabled = false; pauseBtn.disabled = true; });
            birthdayAudio.addEventListener('ended', () => { log("Ended"); playBtn.disabled = false; pauseBtn.disabled = true; });
        } else { err("Audio elements missing!"); }

        // Blow Candle Logic
        const blowBtn=document.getElementById('blow-btn');if(blowBtn){blowBtn.addEventListener('click',function(){log("Blow");const fl=document.querySelectorAll('.flame'),ps=document.getElementById('puff-sound');let act=false;fl.forEach(f=>{if(f?.classList.contains('active')){act=true;f.classList.remove('active');f.style.opacity='0'}});if(act){log("Flames out");if(ps)try{ps.currentTime=0;ps.play().catch(e=>err("Audio",e))}catch(e){err("Audio",e)}try{createSmoke();createConfetti()}catch(e){err("FX",e)}this.disabled=true;setTimeout(()=>{const pop=document.getElementById('blow-popup');if(pop){pop.classList.add('active');log("Popup up");const yay=document.getElementById('yay-button');if(yay){const newY=yay.cloneNode(true);yay.parentNode.replaceChild(newY,yay);newY.addEventListener('click',()=>{log("Yay");closePopup();showStep('step-message')},{once:true})}else err("YayBtn?")}else err("Popup?")},1000)}else log("Blow - no flames active.")})}else err("BlowBtn?");

        // Popups
        function closePopup(){log("Close blowpop");const bp=document.getElementById('blow-popup');if(bp)bp.classList.remove('active')}
        function closeWish(n){log(`Close W${n}`);const wp=document.getElementById(`wish-popup-${n}`),env=document.querySelector(`.envelope-heart[onclick="openWish(${n})"] .envelope`);if(wp)wp.classList.remove('active');if(env)env.classList.remove('open')}
        function openWish(n){log(`Open W${n}`);const wp=document.getElementById(`wish-popup-${n}`),env=document.querySelector(`.envelope-heart[onclick="openWish(${n})"] .envelope`);if(wp){wp.classList.add('active');if(env)env.classList.add('open');else err(`Env ${n}?`)}else err(`WPop ${n}?`)}

        // Effects
        function createConfetti(){try{const c=['#4ade80','#22c55e','#f472b6','#ec4899','#fcd34d','#f59e0b','#86efac','#ecfccb'],o=document.getElementById('confetti-container');if(!o)return;const n=window.innerWidth<768?75:150;for(let i=0;i<n;i++){const e=document.createElement('div');e.className='confetti';e.style.left=Math.random()*100+'vw';e.style.backgroundColor=c[Math.floor(Math.random()*c.length)];e.style.width=Math.random()*8+4+'px';e.style.height=e.style.width;e.style.animationDuration=Math.random()*3+2+'s';e.style.animationDelay=Math.random()*0.5+'s';o.appendChild(e);setTimeout(()=>e?.remove(),5000)}}catch(e){err("FX:Confetti",e)}}
        function createSmoke(){try{const co=document.querySelector('.cake-container'),ca=document.querySelector('.candle-8-mh')||document.querySelector('.candle-1');if(!co||!ca)return;let cr=ca.getBoundingClientRect(),sr=co.getBoundingClientRect(),sy=(cr&&sr&&cr.height!==0&&sr.top!==0)?(cr.top-sr.top):-10;for(let i=0;i<8;i++){const s=document.createElement('div');s.className='absolute w-2 h-2 sm:w-3 sm:h-3 bg-gray-300 rounded-full opacity-60 pointer-events-none';s.style.position='absolute';s.style.left='50%';s.style.top=`${sy}px`;s.style.transform='translateX(-50%)';co.appendChild(s);const ey=sy-(60+Math.random()*40),ex=(Math.random()*50-25);try{if(s.animate){const a=s.animate([{top:`${sy}px`,opacity:0.6,transform:`translateX(-50%) scale(0.8)`},{top:`${ey}px`,opacity:0,transform:`translateX(calc(-50% + ${ex}px)) scale(1.5)`}],{duration:1800+Math.random()*400,easing:'cubic-bezier(0.25,0.1,0.75,0.5)'});a.finished.finally(()=>s?.remove())}else{setTimeout(()=>s?.remove(),2200)}}catch(er){s?.remove()}}}catch(e){err("FX:Smoke",e)}}
        function createFloatingHearts(){try{const c=document.body;if(!c)return;const n=window.innerWidth<768?8:15;for(let i=0;i<n;i++){const h=document.createElement('div');h.className='absolute text-2xl opacity-20 floating pointer-events-none';h.innerHTML='ðŸ’š';h.style.position='fixed';h.style.left=Math.random()*95+2.5+'vw';h.style.top=Math.random()*95+2.5+'vh';h.style.animationDelay=Math.random()*5+'s';h.style.fontSize=Math.random()*16+10+'px';h.style.zIndex='-1';c.appendChild(h)}}catch(e){err("FX:Hearts",e)}}
        function addSprinkles(){try{const lrs=['layer1','layer2','layer3'].map(id=>document.getElementById(id));if(lrs.some(l=>!l))return;const cs=['#f472b6','#ec4899','#fcd34d','#f59e0b','#86efac','#4ade80','#a5b4fc','#818cf8'],lw=[220,185,150],lh=[65,55,45],ns=[15,12,8];lrs.forEach((l,x)=>{if(!l)return;l.querySelectorAll('.cake-sprinkle').forEach(s=>s.remove());for(let i=0;i<ns[x];i++){const s=document.createElement('div');s.className='cake-sprinkle';s.style.position='absolute';s.style.backgroundColor=cs[Math.floor(Math.random()*cs.length)];s.style.width=Math.random()*5+3+'px';s.style.height=s.style.width;s.style.borderRadius='50%';s.style.left=Math.random()*(lw[x]-10)+5+'px';s.style.top=Math.random()*(lh[x]-10)+5+'px';l.appendChild(s)}})}catch(e){err("FX:Sprinkles",e)}}

        // Step Navigation
        let currentStepId=null;function showStep(id){log(`Show:${id}`);const all=document.querySelectorAll('.step'),target=document.getElementById(id);if(!target){err(`No ${id}!`);return}all.forEach(s=>{if(s.id!==id)s.classList.remove('active-step')});target.classList.add('active-step');currentStepId=id;try{window.scrollTo({top:0,behavior:'smooth'})}catch(e){window.scrollTo(0,0)}
        // Pause birthday song if navigating away from audio step
        if(id !== 'step-audio' && birthdayAudio && !birthdayAudio.paused) { log("Pausing Bday audio (nav away)"); birthdayAudio.pause(); }
        // Pause video if navigating away from gallery step
        if(id !== 'step-gallery'){ const video = document.querySelector('#step-gallery video'); if(video && !video.paused) { log("Pausing video (nav away)"); video.pause();} }
        // Reset cake state when showing cake step
        if(id==='step-cake'){log("ResetCake");const fl=document.querySelectorAll('.flame'),btnB=document.getElementById('blow-btn');if(fl.length>0){fl.forEach(f=>{f.style.opacity='1';f.classList.add('active')});log(`Lit ${fl.length}`)}else err("NoFlames");if(btnB){btnB.disabled=false;log("BtnON")}else err("NoBlowBtn");try{addSprinkles()}catch(e){}}
        // Reset wishes state when showing wishes step
        else if(id==='step-wishes'){log("ResetWishes");const oE=document.querySelectorAll('.envelope.open');oE.forEach(e=>e.classList.remove('open'));log(`Closed ${oE.length} envs`);const oP=document.querySelectorAll('.modal.active');let c=0;oP.forEach(p=>{if(p.id.startsWith('wish-')){p.classList.remove('active');c++}});log(`Closed ${c} pops`)}}

        // Init
        function runOnLoad(){log("Init");try{createFloatingHearts();addSprinkles()}catch(e){}const ldr=document.getElementById('loader');if(ldr){log("Loader");const dl=500,fd=700;setTimeout(()=>{ldr.style.opacity='0';setTimeout(()=>{ldr.style.display='none';showStep('step-welcome')},fd)},dl)}else{err("NoLoader!");showStep('step-welcome')}}
        if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',runOnLoad);else runOnLoad();

    </script>

</body>
</html>
